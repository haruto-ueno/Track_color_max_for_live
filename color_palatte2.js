autowatch = 1;
mgraphics.init();
mgraphics.relative_coords = 0; // ピクセル座標系 (左上が0,0)
mgraphics.autofill = 0;


var ableton_colors = [
    [1.000, 0.580, 0.651], // 0 
    [1.000, 0.647, 0.161], // 1 
    [0.800, 0.600, 0.153], // 2 
    [0.969, 0.957, 0.486], // 3 
    [0.749, 0.984, 0.000], // 4 
    [0.102, 1.000, 0.184], // 5 
    [0.145, 1.000, 0.659], // 6 
    [0.361, 1.000, 0.910], // 7 
    [0.545, 0.773, 1.000], // 8 
    [0.329, 0.502, 0.894], // 9 
    [0.573, 0.655, 1.000], // 10 
    [0.847, 0.424, 0.894], // 11 
    [0.898, 0.325, 0.627], // 12 
    [1.000, 1.000, 1.000], // 13 
    [1.000, 0.212, 0.212], // 14 
    [0.965, 0.424, 0.012], // 15 
    [0.600, 0.447, 0.294], // 16 
    [1.000, 0.941, 0.204], // 17 
    [0.529, 1.000, 0.404], // 18 
    [0.239, 0.765, 0.000], // 19 
    [0.000, 0.749, 0.686], // 20 
    [0.098, 0.914, 1.000], // 21 
    [0.063, 0.643, 0.933], // 22 
    [0.000, 0.490, 0.753], // 23 
    [0.533, 0.424, 0.894], // 24 
    [0.714, 0.467, 0.776], // 25 
    [1.000, 0.224, 0.831], // 26 
    [0.816, 0.816, 0.816], // 27 
    [0.886, 0.404, 0.353], // 28 
    [1.000, 0.639, 0.455], // 29 
    [0.827, 0.678, 0.443], // 30 
    [0.929, 1.000, 0.682], // 31 
    [0.824, 0.894, 0.596], // 32 
    [0.729, 0.816, 0.455], // 33 
    [0.608, 0.769, 0.553], // 34 
    [0.831, 0.992, 0.882], // 35 
    [0.804, 0.945, 0.973], // 36 
    [0.725, 0.757, 0.890], // 37 
    [0.804, 0.733, 0.894], // 38 
    [0.682, 0.596, 0.898], // 39 
    [0.898, 0.863, 0.882], // 40 
    [0.663, 0.663, 0.663], // 41 
    [0.776, 0.573, 0.545], // 42 
    [0.718, 0.510, 0.337], // 43 
    [0.600, 0.514, 0.416], // 44 
    [0.749, 0.729, 0.412], // 45 
    [0.651, 0.745, 0.000], // 46 
    [0.490, 0.690, 0.302], // 47 
    [0.533, 0.761, 0.729], // 48 
    [0.608, 0.702, 0.769], // 49 
    [0.522, 0.647, 0.761], // 50 
    [0.514, 0.576, 0.800], // 51 
    [0.647, 0.584, 0.710], // 52 
    [0.749, 0.624, 0.745], // 53 
    [0.737, 0.443, 0.588], // 54 
    [0.482, 0.482, 0.482], // 55 
    [0.686, 0.200, 0.200], // 56 
    [0.663, 0.318, 0.192], // 57 
    [0.447, 0.310, 0.255], // 58 
    [0.859, 0.765, 0.000], // 59 
    [0.522, 0.588, 0.122], // 60 
    [0.325, 0.624, 0.192], // 61 
    [0.039, 0.612, 0.557], // 62 
    [0.137, 0.388, 0.518], // 63 
    [0.102, 0.184, 0.588], // 64 
    [0.184, 0.322, 0.635], // 65 
    [0.384, 0.294, 0.678], // 66 
    [0.639, 0.294, 0.678], // 67 
    [0.800, 0.180, 0.431], // 68 
    [0.235, 0.235, 0.235]  // 69 
];
var cols = 10; 
var rows = 7; 
var selected = -1;

function paint() {
    var w = this.box.rect[2] - this.box.rect[0];
    var h = this.box.rect[3] - this.box.rect[1];

    var cw = w / cols; 
    var ch = h / rows; 


    for (var i = 0; i < ableton_colors.length; i++) {
        var col = i % cols;
        var row = Math.floor(i / cols);

        var x = col * cw;
        var y = row * ch;

        var c = ableton_colors[i];
        mgraphics.set_source_rgba(c[0], c[1], c[2], 1.0);

        mgraphics.rectangle(x, y, cw, ch);
        mgraphics.fill();

        if (i === selected) {
            mgraphics.set_source_rgba(1, 1, 1, 1); // 白
            mgraphics.set_line_width(2);
            mgraphics.rectangle(x + 1, y + 1, cw - 2, ch - 2); 
            mgraphics.stroke();
        }
    }
}

function onclick(x, y) {
    var w = this.box.rect[2] - this.box.rect[0];
    var h = this.box.rect[3] - this.box.rect[1];

    var cw = w / cols;
    var ch = h / rows;

    var col = Math.floor(x / cw);
    var row = Math.floor(y / ch);

    var index = row * cols + col;
    var c = ableton_colors[index];

    if (index >= 0 && index < ableton_colors.length) {
        selected = index;
        outlet(0, index,c[0],c[1],c[2]);
        mgraphics.redraw(); 
    }
}

function onresize(w,h) {
    mgraphics.redraw();
}